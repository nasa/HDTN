add_executable(unit-tests
    src/test_main.cpp
    ../../common/tcpcl/test/TestTcpcl.cpp
	../../common/tcpcl/test/TestTcpclV4.cpp
	../../common/slip_over_uart/test/TestSlip.cpp
	../../common/ltp/test/TestLtp.cpp
	../../common/ltp/test/TestLtpFragmentSet.cpp
	../../common/ltp/test/TestLtpSessionRecreationPreventer.cpp
	../../common/ltp/test/TestLtpRandomNumberGenerator.cpp
	../../common/ltp/test/TestLtpEngine.cpp
	../../common/ltp/test/TestLtpUdpEngine.cpp
	../../common/ltp/test/TestLtpTimerManager.cpp
    ../../common/util/test/TestSdnv.cpp
	../../common/util/test/TestCborUint.cpp
	../../common/util/test/TestCircularIndexBuffer.cpp
	#../../common/util/test/TestRateManagerAsync.cpp
	../../common/util/test/TestTimestampUtil.cpp
	../../common/util/test/TestUri.cpp
	../../common/util/test/TestCcsdsEncap.cpp
	../../common/util/test/TestUtf8Paths.cpp
	../../common/util/test/TestEnumAsFlagsMacro.cpp
	../../common/util/test/TestPaddedVectorUint8.cpp
	../../common/util/test/TestFreeListAllocator.cpp
	$<$<BOOL:${NON_ARM_COMPILATION}>:../../common/util/test/TestCpuFlagDetection.cpp>
	../../common/util/test/TestTokenRateLimiter.cpp
	../../common/util/test/TestUdpBatchSender.cpp
	../../common/util/test/TestJsonSerializable.cpp
	../../common/util/test/TestDirectoryScanner.cpp
	../../common/util/test/TestMemoryInFiles.cpp
	../../common/util/test/TestForwardListQueue.cpp
	../../common/util/test/TestUserDataRecycler.cpp
	../../common/util/test/TestDeadlineTimer.cpp
	../../common/util/test/dir_monitor/test_async.cpp
	../../common/util/test/dir_monitor/test_sync.cpp
	#../../common/util/test/test_running.cpp
	../../common/telemetry_definitions/test/TestTelemetryDefinitions.cpp
	../../common/telemetry_definitions/test/TestTelemetryServer.cpp
	../../common/bpcodec/test/TestAggregateCustodySignal.cpp
	../../common/bpcodec/test/TestCustodyTransfer.cpp
	../../common/bpcodec/test/TestCustodyIdAllocator.cpp
	../../common/bpcodec/test/TestBundleViewV6.cpp
	../../common/bpcodec/test/TestBundleViewV7.cpp
	../../common/bpcodec/test/TestBpv6Fragmentation.cpp
	../../common/bpcodec/test/TestBpsecDefaultSecurityContexts.cpp
	$<$<BOOL:${ENABLE_BPSEC}>:../../common/bpsec/test/TestBpsecDefault.cpp>
	$<$<BOOL:${ENABLE_BPSEC}>:../../common/bpsec/test/TestInitializationVectors.cpp>
	$<$<BOOL:${ENABLE_BPSEC}>:../../common/bpsec/test/TestBpSecPolicyManager.cpp>
	../../common/bpcodec/test/TestBpv7Crc.cpp
	../../common/bpcodec/test/TestBpSinkPattern.cpp
	../../common/config/test/TestInductsConfig.cpp
	../../common/config/test/TestOutductsConfig.cpp
	../../common/config/test/TestStorageConfig.cpp
	../../common/config/test/TestHdtnConfig.cpp
	../../common/config/test/TestHdtnDistributedConfig.cpp
	$<$<BOOL:${ENABLE_BPSEC}>:../../common/config/test/TestBpSecConfig.cpp>
	../../common/cgr/test/TestDijkstra.cpp
	../../common/logger/unit_tests/LoggerTests.cpp
	../../common/stats_logger/unit_tests/StatsLoggerTests.cpp
	#../../common/cgr/test/TestYen.cpp
    ../../module/storage/unit_tests/MemoryManagerTreeArrayTests.cpp
    ../../module/storage/unit_tests/BundleStorageManagerMtTests.cpp
	../../module/storage/unit_tests/TestBundleStorageCatalog.cpp
	../../module/storage/unit_tests/TestBundleUuidToUint64HashMap.cpp
	../../module/storage/unit_tests/TestCustodyTimers.cpp
    ../../module/storage/unit_tests/TestStorageRunner.cpp
    #../../module/storage/unit_tests/BundleStorageManagerMtAsFifoTests.cpp
	$<$<BOOL:${RUN_TELEMETRY}>:../../module/telem_cmd_interface/unit_tests/TelemetryRunnerTests.cpp>
	$<$<BOOL:${RUN_TELEMETRY}>:../../module/telem_cmd_interface/unit_tests/TelemetryConnectionTests.cpp>
	$<$<BOOL:${RUN_TELEMETRY}>:../../module/telem_cmd_interface/unit_tests/TelemetryConnectionPollerTests.cpp>
	$<$<BOOL:${RUN_TELEMETRY}>:../../module/telem_cmd_interface/unit_tests/TelemetryLoggerTests.cpp>
	$<$<BOOL:${RUN_TELEMETRY}>:../../module/telem_cmd_interface/unit_tests/TelemetryRunnerProgramOptionsTests.cpp>
    ../../module/router/unit_tests/RouterTests.cpp
	../../module/cli/test/TestHdtnCliRunner.cpp
)

install(TARGETS unit-tests DESTINATION ${CMAKE_INSTALL_BINDIR})

target_link_libraries(unit-tests
	hdtn_util
	tcpcl_lib
	slip_over_uart_lib
	stcp_lib
	ltp_lib
	storage_lib
	config_lib
	cgr_lib
	ingress_async_lib
	bpcodec
	udp_delay_sim_lib
	log_lib
	stats_lib
	$<$<BOOL:${RUN_TELEMETRY}>:telem_lib>
	$<$<BOOL:${ENABLE_BPSEC}>:bpsec_lib>
	$<$<BOOL:${ENABLE_MASKING}>:masker_lib>
	router_lib
	outduct_manager_lib
	bp_app_patterns_lib
	hdtn_cli_lib
	Boost::unit_test_framework
	Boost::timer
)

set_property(
	SOURCE ../../common/logger/unit_tests/LoggerTests.cpp
	PROPERTY COMPILE_DEFINITIONS
		$<$<BOOL:${LOG_TO_CONSOLE}>:LOG_TO_CONSOLE> 
		$<$<BOOL:${LOG_TO_PROCESS_FILE}>:LOG_TO_PROCESS_FILE>
		$<$<BOOL:${LOG_TO_SUBPROCESS_FILES}>:LOG_TO_SUBPROCESS_FILES>
		$<$<BOOL:${LOG_TO_ERROR_FILE}>:LOG_TO_ERROR_FILE>
)
